import React, { createContext, useContext, useMemo } from "react";

const translations = {
  en: {
    header: {
      title: "MMMF",
      tagline: "Max Money Market Funds. Forecast Best MMF Deposit Amount.",
      github: "View on GitHub",
    },
    common: {
      cancel: "Cancel",
      add: "Add",
      save: "Save",
      today: "Today",
      selectDate: "Select a date",
      auto: "Auto",
    },
    balance: {
      accountBalance: "Account Balance",
      startingBalance: "Starting Balance",
      forecastedBalance: "Forecasted Balance",
      netChange: "Net Change",
      lowestBalance: "Lowest Balance",
      onDate: "on",
      startingBalanceRow: "Starting Balance",
    },
    forecast: {
      settings: "Forecast Settings",
      currentDate: "Current Date",
      forecastUntil: "Forecast Until",
      quick30: "30 days",
      quick60: "60 days",
      quick90: "90 days",
      daysFromCurrent: "days from current date",
      selectFutureDate: "Select a future date",
      clearAll: "Clear All Transactions",
      clearNote: "This will keep your recurring transactions",
    },
    transactions: {
      addTransaction: "Add Transaction",
      description: "Description",
      amount: "Amount",
      type: "Type",
      debitPayment: "Debit (Payment)",
      creditIncome: "Credit (Income)",
      date: "Date",
      addBtn: "Add Transaction",
      fillAllFields: "Please fill in all fields",
      listTitle: (count) => `Transactions (${count})`,
      noneYet: "No transactions yet",
      getStarted: "Add your first transaction to get started",
      delete: "Delete transaction",
      descriptionPh: "e.g., 0DTE SPY Call Margin Requirement",
      amountPh: "0.00",
    },
    recurring: {
      title: "Recurring Transactions",
      addButton: "+ Add",
      saveRecurring: "Save Recurring Transaction",
      noRecurring: "No recurring transactions",
      autoNote: "Recurring transactions are auto-generated each month",
      payment: "Payment",
      income: "Income",
      descriptionPh: "Description",
      amountPh: "Amount",
      dayOfMonthPh: "Day of Month (1-31)",
      dayOfMonth: (day) => `Day ${day} of month`,
      clickToEditDesc: "Click to edit description",
      clickToEditAmount: "Click to edit amount",
      deleteRecurring: "Delete recurring transaction",
      validationAll: "Please fill in all fields",
      validationDayRange: "Day of month must be between 1 and 31",
    },
    cards: {
      title: "Recurring Credit Cards",
      saveCard: "Save Credit Card",
      noCards: "No credit cards",
      addNote: "Add credit cards to quickly enter payments",
      cardNamePh: "Card Name (e.g., Chase Sapphire)",
      deleteCard: "Delete credit card",
      dayOfMonth: (day) => `Day ${day} of month`,
      clickToEditName: "Click to edit name",
      next: "Next:",
      addPayment: "Add Payment",
      noUpcoming: "No upcoming date",
      paymentDate: "Payment date:",
      enterAmount: "Please enter amount",
      noUpcomingInRange: "No upcoming payment date within forecast range",
    },
    timeline: {
      title: "Balance Timeline",
      action: "Action",
      description: "Description",
      amount: "Amount",
      balance: "Balance",
      date: "Date",
      delete: "Delete transaction",
    },
    settings: {
      globalSettings: "Global Settings",
      darkMode: "Dark Mode",
      lightMode: "Light Mode",
      language: "Language",
      currency: "Currency",
      dateFormat: "Date Format",
    },
    datepicker: {
      weekdaysShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
    },
  },
  es: {
    header: {
      title: "MMMF",
      tagline:
        "Fondos del Mercado Monetario Máximos. Pronostica el mejor depósito en MMF.",
      github: "Ver en GitHub",
    },
    common: {
      cancel: "Cancelar",
      add: "Agregar",
      save: "Guardar",
      today: "Hoy",
      selectDate: "Selecciona una fecha",
      auto: "Auto",
    },
    balance: {
      accountBalance: "Saldo de la cuenta",
      startingBalance: "Saldo inicial",
      forecastedBalance: "Saldo proyectado",
      netChange: "Cambio neto",
      lowestBalance: "Saldo más bajo",
      onDate: "el",
      startingBalanceRow: "Saldo inicial",
    },
    forecast: {
      settings: "Configuración de pronóstico",
      currentDate: "Fecha actual",
      forecastUntil: "Pronosticar hasta",
      quick30: "30 días",
      quick60: "60 días",
      quick90: "90 días",
      daysFromCurrent: "días desde la fecha actual",
      selectFutureDate: "Selecciona una fecha futura",
      clearAll: "Borrar todas las transacciones",
      clearNote: "Se mantendrán las transacciones recurrentes",
    },
    transactions: {
      addTransaction: "Agregar transacción",
      description: "Descripción",
      amount: "Monto",
      type: "Tipo",
      debitPayment: "Débito (Pago)",
      creditIncome: "Crédito (Ingreso)",
      date: "Fecha",
      addBtn: "Agregar transacción",
      fillAllFields: "Por favor completa todos los campos",
      listTitle: (count) => `Transacciones (${count})`,
      noneYet: "Sin transacciones",
      getStarted: "Agrega tu primera transacción para comenzar",
      delete: "Eliminar transacción",
      descriptionPh: "ej., Requisito de margen de call SPY 0DTE",
      amountPh: "0.00",
    },
    recurring: {
      title: "Transacciones recurrentes",
      addButton: "+ Agregar",
      saveRecurring: "Guardar transacción recurrente",
      noRecurring: "Sin transacciones recurrentes",
      autoNote:
        "Las transacciones recurrentes se generan automáticamente cada mes",
      payment: "Pago",
      income: "Ingreso",
      descriptionPh: "Descripción",
      amountPh: "Monto",
      dayOfMonthPh: "Día del mes (1-31)",
      dayOfMonth: (day) => `Día ${day} del mes`,
      clickToEditDesc: "Haz clic para editar la descripción",
      clickToEditAmount: "Haz clic para editar el monto",
      deleteRecurring: "Eliminar transacción recurrente",
      validationAll: "Por favor completa todos los campos",
      validationDayRange: "El día del mes debe estar entre 1 y 31",
    },
    cards: {
      title: "Tarjetas de crédito recurrentes",
      saveCard: "Guardar tarjeta",
      noCards: "Sin tarjetas de crédito",
      addNote: "Agrega tarjetas para ingresar pagos rápidamente",
      cardNamePh: "Nombre de la tarjeta (ej., Chase Sapphire)",
      deleteCard: "Eliminar tarjeta",
      dayOfMonth: (day) => `Día ${day} del mes`,
      clickToEditName: "Haz clic para editar el nombre",
      next: "Próximo:",
      addPayment: "Agregar pago",
      noUpcoming: "Sin fecha próxima",
      paymentDate: "Fecha de pago:",
      enterAmount: "Por favor ingresa un monto",
      noUpcomingInRange: "No hay fecha de pago dentro del rango",
    },
    timeline: {
      title: "Línea de tiempo del saldo",
      action: "Acción",
      description: "Descripción",
      amount: "Monto",
      balance: "Saldo",
      date: "Fecha",
      delete: "Eliminar transacción",
    },
    settings: {
      globalSettings: "Configuración global",
      darkMode: "Modo oscuro",
      lightMode: "Modo claro",
      language: "Idioma",
      currency: "Moneda",
      dateFormat: "Formato de fecha",
    },
    datepicker: {
      weekdaysShort: ["Dom", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb"],
    },
  },
  zht: {
    header: {
      title: "MMMF",
      tagline: "未來帳戶餘額預測工具",
      github: "在 GitHub 上查看",
    },
    common: {
      cancel: "取消",
      add: "新增",
      save: "儲存",
      today: "今天",
      selectDate: "選擇日期",
      auto: "自動",
    },
    balance: {
      accountBalance: "帳戶餘額",
      startingBalance: "起始金額",
      forecastedBalance: "預測餘額",
      netChange: "淨變化",
      lowestBalance: "最低餘額",
      onDate: "於",
      startingBalanceRow: "起始金額",
    },
    forecast: {
      settings: "設定",
      currentDate: "開始日期",
      forecastUntil: "預測至日期",
      quick30: "30 天",
      quick60: "60 天",
      quick90: "90 天",
      daysFromCurrent: "總共天數",
      selectFutureDate: "選擇未來日期",
      clearAll: "清除所有交易紀錄",
      clearNote: "這會保留您的重複性扣款",
    },
    transactions: {
      addTransaction: "單筆輸入",
      description: "描述",
      amount: "金額",
      type: "類型",
      debitPayment: "支出",
      creditIncome: "收入",
      date: "日期",
      addBtn: "新增款項",
      fillAllFields: "請填寫所有欄位",
      listTitle: (count) => `交易（${count}）`,
      noneYet: "尚無交易",
      getStarted: "新增您的第一筆交易以開始使用",
      delete: "刪除交易",
      descriptionPh: "例如：0DTE SPY 期權當沖保證金要求",
      amountPh: "0.00",
    },
    recurring: {
      title: "重複性扣款",
      addButton: "+ 新增",
      saveRecurring: "儲存重複性扣款",
      noRecurring: "無重複性扣款",
      autoNote: "重複性扣款會於每個月自動生成",
      payment: "支出",
      income: "收入",
      descriptionPh: "描述",
      amountPh: "金額",
      dayOfMonthPh: "每月日期（1-31）",
      dayOfMonth: (day) => `每月第 ${day} 天`,
      clickToEditDesc: "點擊編輯描述",
      clickToEditAmount: "點擊編輯金額",
      deleteRecurring: "刪除定期交易",
      validationAll: "請填寫所有欄位",
      validationDayRange: "每月日期必須在 1 到 31 之間",
    },
    cards: {
      title: "定期信用卡",
      saveCard: "儲存信用卡",
      noCards: "無信用卡",
      addNote: "新增信用卡以快速輸入付款",
      cardNamePh: "卡片名稱（例如：富邦信用卡）",
      deleteCard: "刪除信用卡",
      dayOfMonth: (day) => `每月第 ${day} 天`,
      clickToEditName: "點擊編輯名稱",
      next: "下次：",
      addPayment: "新增付款",
      noUpcoming: "無即將到來的日期",
      paymentDate: "付款日期：",
      enterAmount: "請輸入金額",
      noUpcomingInRange: "預測範圍內無即將到來的付款日期",
    },
    timeline: {
      title: "餘額時間軸",
      action: "操作",
      description: "描述",
      amount: "金額",
      balance: "餘額",
      date: "日期",
      delete: "刪除交易",
    },
    settings: {
      globalSettings: "全域設定",
      darkMode: "深色模式",
      lightMode: "淺色模式",
      language: "語言",
      currency: "貨幣",
      dateFormat: "日期格式",
    },
    datepicker: {
      weekdaysShort: ["日", "一", "二", "三", "四", "五", "六"],
    },
  },
  ja: {
    header: {
      title: "MMMF",
      tagline: "未来口座残高の予測",
      github: "GitHub で見る",
    },
    common: {
      cancel: "キャンセル",
      add: "追加",
      save: "保存",
      today: "今日",
      selectDate: "日付を選択",
      auto: "自動",
    },
    balance: {
      accountBalance: "口座残高",
      startingBalance: "開始残高",
      forecastedBalance: "予測残高",
      netChange: "純変化",
      lowestBalance: "最低残高",
      onDate: "予測日",
      startingBalanceRow: "開始残高",
    },
    forecast: {
      settings: "予測設定",
      currentDate: "現在の日付",
      forecastUntil: "予測期間",
      quick30: "30日",
      quick60: "60日",
      quick90: "90日",
      daysFromCurrent: "日（現在の日付から）",
      selectFutureDate: "将来の日付を選択",
      clearAll: "すべての取引をクリア",
      clearNote: "定期取引は保持されます",
    },
    transactions: {
      addTransaction: "取引を追加",
      description: "説明",
      amount: "金額",
      type: "タイプ",
      debitPayment: "支払い",
      creditIncome: "収入",
      date: "日付",
      addBtn: "取引を追加",
      fillAllFields: "すべてのフィールドを入力してください",
      listTitle: (count) => `取引（${count}）`,
      noneYet: "取引がありません",
      getStarted: "最初の取引を追加して開始",
      delete: "取引を削除",
      descriptionPh: "例：0DTE SPY 先物オプション保証金",
      amountPh: "0.00",
    },
    recurring: {
      title: "定期取引",
      addButton: "+ 追加",
      saveRecurring: "定期取引を保存",
      noRecurring: "定期取引がありません",
      autoNote: "定期取引は毎月自動生成されます",
      payment: "支払い",
      income: "収入",
      descriptionPh: "説明",
      amountPh: "金額",
      dayOfMonthPh: "月の日（1-31）",
      dayOfMonth: (day) => `毎月${day}日`,
      clickToEditDesc: "クリックして説明を編集",
      clickToEditAmount: "クリックして金額を編集",
      deleteRecurring: "定期取引を削除",
      validationAll: "すべてのフィールドを入力してください",
      validationDayRange: "月の日は1から31の間でなければなりません",
    },
    cards: {
      title: "定期クレジットカード",
      saveCard: "クレジットカードを保存",
      noCards: "クレジットカードがありません",
      addNote: "支払いを素早く入力するためにクレジットカードを追加",
      cardNamePh: "カード名（例：エポスカード）",
      deleteCard: "クレジットカードを削除",
      dayOfMonth: (day) => `毎月${day}日`,
      clickToEditName: "クリックして名前を編集",
      next: "次回：",
      addPayment: "支払いを追加",
      noUpcoming: "予定日なし",
      paymentDate: "支払日：",
      enterAmount: "金額を入力してください",
      noUpcomingInRange: "予測範囲内に支払日がありません",
    },
    timeline: {
      title: "残高タイムライン",
      action: "アクション",
      description: "説明",
      amount: "金額",
      balance: "残高",
      date: "日付",
      delete: "取引を削除",
    },
    settings: {
      globalSettings: "グローバル設定",
      darkMode: "ダークモード",
      lightMode: "ライトモード",
      language: "言語",
      currency: "通貨",
      dateFormat: "日付形式",
    },
    datepicker: {
      weekdaysShort: ["日", "月", "火", "水", "木", "金", "土"],
    },
  },
};

const I18nContext = createContext({
  language: "en",
  setLanguage: () => {},
  t: (key, ...args) => key,
});

export function I18nProvider({ language, setLanguage, children }) {
  const t = useMemo(() => {
    return (key, ...args) => {
      const [ns, k] = key.split(":");
      const langTable = translations[language] || translations.en;
      const segments = (k || ns).split(".");
      let node = ns && k ? langTable[ns] : langTable;
      for (const seg of segments) {
        if (!node) break;
        node = node[seg];
      }
      if (typeof node === "function") {
        return node(...args);
      }
      if (typeof node === "string") {
        return node;
      }
      return key; // fallback to key
    };
  }, [language]);

  const value = useMemo(
    () => ({ language, setLanguage, t }),
    [language, setLanguage, t]
  );
  return React.createElement(I18nContext.Provider, { value }, children);
}

export function useI18n() {
  return useContext(I18nContext);
}
